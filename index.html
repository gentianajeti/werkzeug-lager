<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Werkzeug-Lager Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --color-primary: #0ea5e9;
            --color-primary-dark: #0284c7;
            --color-secondary: #8b5cf6;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --bg-sidebar: #1e293b;
            --bg-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --text-inverse: #ffffff;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.15);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg-main); color: var(--text-primary); line-height: 1.6; }
        
        /* Login Screen */
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--bg-sidebar) 0%, #334155 100%); padding: 20px; }
        .login-box { background: var(--bg-card); border-radius: var(--radius-lg); padding: 40px; max-width: 400px; width: 100%; box-shadow: var(--shadow-lg); }
        .login-header { text-align: center; margin-bottom: 30px; }
        .login-logo { font-size: 3rem; margin-bottom: 10px; }
        .login-title { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); }
        .login-subtitle { color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; }
        .login-error { background: var(--color-danger); color: white; padding: 12px; border-radius: var(--radius-sm); margin-bottom: 20px; display: none; font-size: 0.9rem; }
        .login-error.show { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: var(--text-secondary); }
        .form-input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 1rem; font-family: inherit; transition: border-color 0.2s; }
        .form-input:focus { outline: none; border-color: var(--color-primary); }
        
        /* Buttons */
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; border-radius: var(--radius-sm); font-size: 0.95rem; font-weight: 600; cursor: pointer; border: none; transition: all 0.2s; font-family: inherit; }
        .btn-primary { background: var(--color-primary); color: white; }
        .btn-primary:hover { background: var(--color-primary-dark); }
        .btn-secondary { background: var(--bg-hover); color: var(--text-primary); }
        .btn-danger { background: var(--color-danger); color: white; }
        .btn-sm { padding: 8px 12px; font-size: 0.85rem; }
        
        /* App Container */
        .app-container { display: none; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 280px; background: var(--bg-sidebar); color: var(--text-inverse); padding: 30px 0; position: fixed; height: 100vh; overflow-y: auto; z-index: 1000; transition: transform 0.3s; }
        .logo { padding: 0 30px 30px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .logo h1 { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--color-primary), var(--color-secondary)); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .nav-menu { list-style: none; }
        .nav-item { padding: 0 20px; margin-bottom: 5px; }
        .nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: var(--radius-sm); color: var(--text-muted); text-decoration: none; transition: all 0.2s; cursor: pointer; }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.1); color: var(--text-inverse); }
        .nav-icon { font-size: 1.2rem; }
        .user-info { padding: 20px 30px; border-top: 1px solid rgba(255,255,255,0.1); margin-top: auto; position: absolute; bottom: 0; width: 100%; }
        .user-email { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px; word-break: break-all; }
        
        /* Main Content */
        .main-content { margin-left: 280px; padding: 30px; min-height: 100vh; }
        .page { display: none; }
        .page.active { display: block; }
        .page-header { margin-bottom: 30px; }
        .page-title { font-size: 1.8rem; font-weight: 700; color: var(--text-primary); }
        .page-subtitle { color: var(--text-muted); margin-top: 5px; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--bg-card); border-radius: var(--radius-lg); padding: 24px; box-shadow: var(--shadow-sm); }
        .stat-icon { width: 50px; height: 50px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
        .stat-icon.blue { background: rgba(14, 165, 233, 0.1); }
        .stat-icon.purple { background: rgba(139, 92, 246, 0.1); }
        .stat-icon.green { background: rgba(16, 185, 129, 0.1); }
        .stat-icon.amber { background: rgba(245, 158, 11, 0.1); }
        .stat-label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; }
        .stat-value { font-size: 1.8rem; font-weight: 700; color: var(--text-primary); }
        
        /* Controls */
        .controls-bar { background: var(--bg-card); border-radius: var(--radius-lg); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow-sm); }
        .controls-row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        .search-wrapper { position: relative; flex: 1; min-width: 200px; }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-input { width: 100%; padding: 12px 12px 12px 42px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 0.95rem; }
        .search-input:focus { outline: none; border-color: var(--color-primary); }
        .filter-select { padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 0.95rem; min-width: 150px; background: white; }
        
        /* Items Grid */
        .items-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .item-card { background: var(--bg-card); border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm); transition: all 0.2s; }
        .item-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
        .item-content { padding: 20px; }
        .item-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }
        .item-brand { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 12px; }
        .item-badges { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .badge-category { background: rgba(139, 92, 246, 0.1); color: var(--color-secondary); }
        .badge-location { background: rgba(14, 165, 233, 0.1); color: var(--color-primary); }
        .badge-quantity { background: rgba(16, 185, 129, 0.1); color: var(--color-success); }
        .item-actions { display: flex; gap: 8px; margin-top: 15px; }
        
        /* Location Hierarchy */
        .location-hierarchy { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
        .location-part { background: var(--bg-hover); padding: 4px 10px; border-radius: var(--radius-sm); font-size: 0.8rem; font-weight: 500; }
        .location-separator { color: var(--text-muted); font-size: 0.8rem; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-card); border-radius: var(--radius-lg); max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-title { font-size: 1.3rem; font-weight: 700; }
        .modal-body { padding: 24px; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted); }
        .form-section { margin-bottom: 24px; }
        .section-title { font-size: 0.9rem; font-weight: 600; color: var(--text-muted); margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .form-grid.single { grid-template-columns: 1fr; }
        .form-select { width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 0.95rem; background: white; }
        .form-textarea { width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-sm); font-size: 0.95rem; min-height: 80px; resize: vertical; font-family: inherit; }
        .required { color: var(--color-danger); }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-icon { font-size: 4rem; margin-bottom: 20px; }
        .empty-title { font-size: 1.3rem; font-weight: 600; margin-bottom: 10px; }
        .empty-text { color: var(--text-muted); margin-bottom: 20px; }
        
        /* Photo Upload */
        .photo-upload-zone { border: 2px dashed var(--border-color); border-radius: var(--radius-md); padding: 30px; text-align: center; cursor: pointer; transition: all 0.2s; }
        .photo-upload-zone:hover { border-color: var(--color-primary); background: rgba(14, 165, 233, 0.05); }
        .upload-icon { font-size: 2rem; margin-bottom: 10px; }
        .upload-text { color: var(--text-muted); font-size: 0.9rem; }
        .photo-preview { max-width: 100%; max-height: 200px; border-radius: var(--radius-md); margin-top: 15px; }
        
        /* QR Code */
        .qr-code-display { text-align: center; padding: 20px; background: var(--bg-hover); border-radius: var(--radius-md); }
        .qr-label { margin-top: 10px; font-weight: 600; color: var(--text-secondary); }
        .qr-actions { margin-top: 15px; }
        
        /* Category Tag */
        .category-tag { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-hover); border-radius: var(--radius-md); margin: 4px; font-size: 0.85rem; }
        .category-tag .delete-tag { cursor: pointer; color: var(--color-danger); font-weight: bold; }
        
        /* Mobile Menu */
        .mobile-menu-btn { display: none; position: fixed; top: 20px; left: 20px; z-index: 1001; width: 50px; height: 50px; border-radius: var(--radius-md); background: var(--bg-sidebar); color: var(--text-inverse); border: none; font-size: 1.5rem; cursor: pointer; box-shadow: var(--shadow-lg); }
        .mobile-menu-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
        .mobile-menu-overlay.active { display: block; }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .mobile-menu-btn { display: flex; align-items: center; justify-content: center; }
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding-top: 80px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .form-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .main-content { padding: 80px 15px 20px; }
            .page-title { font-size: 1.5rem; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 12px; }
            .stat-card { padding: 16px; }
            .stat-value { font-size: 1.4rem; }
            .controls-row { flex-direction: column; }
            .search-wrapper { width: 100%; }
            .filter-select { width: 100%; }
            .btn { width: 100%; justify-content: center; }
            .items-grid { grid-template-columns: 1fr; }
            .modal-content { margin: 10px; max-height: 95vh; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-header">
                <div class="login-logo">üîß</div>
                <h1 class="login-title">Werkzeug Pro</h1>
                <p class="login-subtitle">Bitte melde dich an</p>
            </div>
            <div id="loginError" class="login-error"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">E-Mail</label>
                    <input type="email" class="form-input" id="loginEmail" required placeholder="deine@email.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Passwort</label>
                    <input type="password" class="form-input" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="btn btn-primary" id="loginBtn" style="width:100%; justify-content:center;">
                    <span>üîì</span>
                    <span>Anmelden</span>
                </button>
            </form>
            <p id="authStatus" style="text-align:center; margin-top:20px; font-size:0.8rem; color:var(--text-muted);">Initialisiere...</p>
        </div>
    </div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" onclick="toggleMobileMenu()">‚ò∞</button>
    <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="toggleMobileMenu()"></div>

    <!-- App Container -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h1><span class="logo-icon">üîß</span>Werkzeug Pro</h1>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a class="nav-link active" data-page="werkzeuge" onclick="showPage('werkzeuge')">
                            <span class="nav-icon">üîß</span>
                            <span>Werkzeuge</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="lagerplaetze" onclick="showPage('lagerplaetze')">
                            <span class="nav-icon">üì¶</span>
                            <span>Lagerpl√§tze</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="kategorien" onclick="showPage('kategorien')">
                            <span class="nav-icon">üè∑Ô∏è</span>
                            <span>Kategorien</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="user-info">
                <div class="user-email" id="userEmail"></div>
                <button class="btn btn-secondary btn-sm" onclick="handleLogout()" style="width:100%;">
                    <span>üö™</span>
                    <span>Abmelden</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Werkzeuge Page -->
            <div id="page-werkzeuge" class="page active">
                <div class="page-header">
                    <h1 class="page-title">Werkzeuge</h1>
                    <p class="page-subtitle">Verwalte dein Inventar</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üîß</div>
                        <div class="stat-label">Werkzeuge</div>
                        <div class="stat-value" id="statItems">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">üìÅ</div>
                        <div class="stat-label">Kategorien</div>
                        <div class="stat-value" id="statCategories">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">üì¶</div>
                        <div class="stat-label">Lagerpl√§tze</div>
                        <div class="stat-value" id="statLocations">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon amber">üí∞</div>
                        <div class="stat-label">Gesamtwert</div>
                        <div class="stat-value" id="statValue">CHF 0</div>
                    </div>
                </div>

                <div class="controls-bar">
                    <div class="controls-row">
                        <div class="search-wrapper">
                            <span class="search-icon">üîç</span>
                            <input type="text" class="search-input" id="searchInput" placeholder="Suchen..." oninput="renderItems()">
                        </div>
                        <select class="filter-select" id="categoryFilter" onchange="renderItems()">
                            <option value="">Alle Kategorien</option>
                        </select>
                        <button class="btn btn-primary" onclick="openItemModal()">
                            <span>+</span>
                            <span>Hinzuf√ºgen</span>
                        </button>
                    </div>
                </div>

                <div class="items-grid" id="itemsGrid"></div>
            </div>

            <!-- Lagerpl√§tze Page -->
            <div id="page-lagerplaetze" class="page">
                <div class="page-header">
                    <h1 class="page-title">Lagerpl√§tze</h1>
                    <p class="page-subtitle">Verwalte deine Lagerstruktur</p>
                </div>
                <div class="controls-bar">
                    <div class="controls-row">
                        <button class="btn btn-primary" onclick="openLocationModal()">
                            <span>+</span>
                            <span>Lagerplatz erstellen</span>
                        </button>
                    </div>
                </div>
                <div class="items-grid" id="locationsGrid"></div>
            </div>

            <!-- Kategorien Page -->
            <div id="page-kategorien" class="page">
                <div class="page-header">
                    <h1 class="page-title">Kategorien</h1>
                    <p class="page-subtitle">Verwalte Haupt- und Unterkategorien</p>
                </div>
                <div class="controls-bar">
                    <div class="controls-row">
                        <button class="btn btn-primary" onclick="openCategoryModal()">
                            <span>+</span>
                            <span>Kategorie erstellen</span>
                        </button>
                    </div>
                </div>
                <div class="items-grid" id="categoriesGrid"></div>
            </div>
        </main>
    </div>

    <!-- Item Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="itemModalTitle">Werkzeug hinzuf√ºgen</h2>
                <button class="close-btn" onclick="closeItemModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="itemForm" onsubmit="saveItem(event)">
                    <div class="form-section">
                        <h3 class="section-title"><span>üìù</span>Grunddaten</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="itemName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Menge</label>
                                <input type="number" class="form-input" id="itemQuantity" value="1" min="1">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Marke</label>
                                <input type="text" class="form-input" id="itemBrand">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Modell</label>
                                <input type="text" class="form-input" id="itemModel">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title"><span>üè∑Ô∏è</span>Kategorie</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Hauptkategorie <span class="required">*</span></label>
                                <select class="form-select" id="itemCategory" required onchange="updateSubCategories()">
                                    <option value="">W√§hlen...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unterkategorie</label>
                                <select class="form-select" id="itemSubCategory">
                                    <option value="">Keine</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title"><span>üìç</span>Lagerort</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Lagerplatz</label>
                                <select class="form-select" id="itemLocation" onchange="fillLocationFields()">
                                    <option value="">Manuell eingeben</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Zone</label>
                                <input type="text" class="form-input" id="itemZone" placeholder="z.B. Keller">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Regal</label>
                                <input type="text" class="form-input" id="itemRegal" placeholder="z.B. Regal A">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Platz</label>
                                <input type="text" class="form-input" id="itemPlatz" placeholder="z.B. Ebene 2">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fach</label>
                                <input type="text" class="form-input" id="itemFach" placeholder="z.B. Schublade 1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title"><span>üí∞</span>Details</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Wert (CHF)</label>
                                <input type="number" class="form-input" id="itemValue" value="0" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-grid single">
                            <div class="form-group">
                                <label class="form-label">Notizen</label>
                                <textarea class="form-textarea" id="itemNotes" placeholder="Zus√§tzliche Informationen..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3 class="section-title"><span>üì∑</span>Foto</h3>
                        <div class="photo-upload-zone" onclick="document.getElementById('photoInput').click()">
                            <div class="upload-icon">üì∑</div>
                            <div class="upload-text">Foto hochladen</div>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" style="display:none" onchange="previewPhoto(event)">
                        <div id="photoPreviewContainer" style="display:none; text-align:center; margin-top:15px;">
                            <img id="photoPreview" class="photo-preview">
                            <button type="button" class="btn btn-danger btn-sm" onclick="removePhoto()" style="margin-top:10px;">üóëÔ∏è Entfernen</button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width:100%; justify-content:center;">
                        <span>üíæ</span>
                        <span>Speichern</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Location Modal -->
    <div class="modal" id="locationModal">
        <div class="modal-content" style="max-width:450px;">
            <div class="modal-header">
                <h2 class="modal-title">Lagerplatz erstellen</h2>
                <button class="close-btn" onclick="closeLocationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="locationForm" onsubmit="saveLocation(event)">
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Zone <span class="required">*</span></label>
                                <input type="text" class="form-input" id="locZone" required placeholder="z.B. Keller">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Regal</label>
                                <input type="text" class="form-input" id="locRegal" placeholder="z.B. Regal A">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Platz</label>
                                <input type="text" class="form-input" id="locPlatz" placeholder="z.B. Ebene 2">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fach</label>
                                <input type="text" class="form-input" id="locFach" placeholder="z.B. Schublade 1">
                            </div>
                        </div>
                        <div class="form-grid single">
                            <div class="form-group">
                                <label class="form-label">Beschreibung</label>
                                <textarea class="form-textarea" id="locDescription" placeholder="Optionale Beschreibung"></textarea>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; justify-content:center;">
                        <span>üì¶</span>
                        <span>Erstellen</span>
                    </button>
                </form>
                <div id="qrCodeDisplay" style="display:none; margin-top:24px;">
                    <div class="qr-code-display">
                        <canvas id="qrCanvas"></canvas>
                        <div class="qr-label" id="qrLabel"></div>
                        <div class="qr-actions">
                            <button class="btn btn-primary btn-sm" onclick="downloadQR()">
                                <span>üì•</span>
                                <span>Download QR</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content" style="max-width:450px;">
            <div class="modal-header">
                <h2 class="modal-title">Kategorie erstellen</h2>
                <button class="close-btn" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="categoryForm" onsubmit="saveCategory(event)">
                    <div class="form-section">
                        <div class="form-grid single">
                            <div class="form-group">
                                <label class="form-label">Name <span class="required">*</span></label>
                                <input type="text" class="form-input" id="catName" required placeholder="z.B. Elektrowerkzeug">
                            </div>
                        </div>
                        <div class="form-grid single">
                            <div class="form-group">
                                <label class="form-label">Icon (Emoji)</label>
                                <input type="text" class="form-input" id="catIcon" placeholder="z.B. ‚ö°" maxlength="2">
                            </div>
                        </div>
                        <div class="form-grid single">
                            <div class="form-group">
                                <label class="form-label">Unterkategorien</label>
                                <div id="subCatTags" style="margin-bottom:8px;"></div>
                                <div style="display:flex; gap:8px;">
                                    <input type="text" class="form-input" id="newSubCat" placeholder="Unterkategorie hinzuf√ºgen">
                                    <button type="button" class="btn btn-secondary" onclick="addSubCat()">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width:100%; justify-content:center;">
                        <span>üè∑Ô∏è</span>
                        <span>Speichern</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBcGvs8ktnV8nResR5euLhty6BLW_gdz7Q",
            authDomain: "werkzeuglager-home.firebaseapp.com",
            databaseURL: "https://werkzeuglager-home-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "werkzeuglager-home",
            storageBucket: "werkzeuglager-home.firebasestorage.app",
            messagingSenderId: "360393799164",
            appId: "1:360393799164:web:d95f8242900e577690ae79"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // ============================================
        // STATE
        // ============================================
        let items = [];
        let locations = [];
        let categories = [];
        let currentEditId = null;
        let currentLocationId = null;
        let tempSubCategories = [];

        // ============================================
        // AUTH
        // ============================================
        document.getElementById('authStatus').textContent = 'Firebase geladen...';

        auth.onAuthStateChanged((user) => {
            console.log('Auth State:', user ? user.email : 'Nicht eingeloggt');
            document.getElementById('authStatus').textContent = user ? 'Eingeloggt als ' + user.email : 'Nicht eingeloggt';
            
            if (user) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                document.getElementById('userEmail').textContent = user.email;
                initApp();
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
            }
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const btn = document.getElementById('loginBtn');
            
            errorDiv.classList.remove('show');
            btn.innerHTML = '<span>‚è≥</span><span>Anmelden...</span>';
            btn.disabled = true;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((result) => {
                    console.log('Login erfolgreich:', result.user.email);
                })
                .catch((error) => {
                    console.error('Login Fehler:', error);
                    errorDiv.textContent = error.message;
                    errorDiv.classList.add('show');
                    btn.innerHTML = '<span>üîì</span><span>Anmelden</span>';
                    btn.disabled = false;
                });
        });

        function handleLogout() {
            auth.signOut();
        }

        // ============================================
        // INIT APP
        // ============================================
        function initApp() {
            // Load items
            database.ref('werkzeuge').on('value', (snapshot) => {
                items = [];
                snapshot.forEach((child) => {
                    items.push({ id: child.key, ...child.val() });
                });
                renderItems();
                updateStats();
            });

            // Load locations
            database.ref('lagerplaetze').on('value', (snapshot) => {
                locations = [];
                snapshot.forEach((child) => {
                    locations.push({ id: child.key, ...child.val() });
                });
                renderLocations();
                updateLocationSelect();
                updateStats();
            });

            // Load categories
            database.ref('kategorien').on('value', (snapshot) => {
                categories = [];
                snapshot.forEach((child) => {
                    categories.push({ id: child.key, ...child.val() });
                });
                
                // Create default categories if none exist
                if (categories.length === 0) {
                    createDefaultCategories();
                }
                
                renderCategories();
                updateCategorySelect();
                updateStats();
            });
        }

        // ============================================
        // DEFAULT CATEGORIES
        // ============================================
        function createDefaultCategories() {
            const defaults = [
                { name: 'Elektrowerkzeug', icon: '‚ö°', subCategories: ['Bohrmaschinen', 'S√§gen', 'Schleifer', 'Schrauber'] },
                { name: 'Handwerkzeug', icon: 'üîß', subCategories: ['Schraubendreher', 'Zangen', 'H√§mmer', 'Schraubenschl√ºssel'] },
                { name: 'Messwerkzeug', icon: 'üìè', subCategories: ['Massb√§nder', 'Wasserwaagen', 'Laser'] },
                { name: 'Gartenwerkzeug', icon: 'üåø', subCategories: ['Rasenpflege', 'Heckenscheren', 'Spaten'] },
                { name: 'Sicherheit', icon: 'ü¶∫', subCategories: ['Handschuhe', 'Schutzbrillen', 'Geh√∂rschutz'] },
                { name: 'Sonstiges', icon: 'üì¶', subCategories: ['Diverses', 'Verbrauchsmaterial'] }
            ];
            
            defaults.forEach(cat => {
                database.ref('kategorien').push(cat);
            });
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        function renderItems() {
            const grid = document.getElementById('itemsGrid');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;

            let filtered = items.filter(item => {
                const matchesSearch = !searchTerm || 
                    item.name.toLowerCase().includes(searchTerm) ||
                    (item.brand && item.brand.toLowerCase().includes(searchTerm));
                const matchesCategory = !categoryFilter || item.mainCategory === categoryFilter;
                return matchesSearch && matchesCategory;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üîß</div>
                        <div class="empty-title">Keine Werkzeuge</div>
                        <div class="empty-text">F√ºge dein erstes Werkzeug hinzu</div>
                        <button class="btn btn-primary" onclick="openItemModal()">
                            <span>+</span>
                            <span>Hinzuf√ºgen</span>
                        </button>
                    </div>`;
                return;
            }

            grid.innerHTML = filtered.map(item => {
                const locationParts = [item.zone, item.regal, item.platz, item.fach].filter(Boolean);
                return `
                    <div class="item-card">
                        ${item.photo ? `<img src="${item.photo}" style="width:100%; height:150px; object-fit:cover;">` : ''}
                        <div class="item-content">
                            <div class="item-name">${item.name}</div>
                            ${item.brand ? `<div class="item-brand">${item.brand}${item.model ? ' ' + item.model : ''}</div>` : ''}
                            <div class="item-badges">
                                <span class="badge badge-category">${item.mainCategory || 'Ohne Kategorie'}</span>
                                <span class="badge badge-quantity">${item.quantity || 1}x</span>
                                ${item.value ? `<span class="badge badge-location">CHF ${item.value}</span>` : ''}
                            </div>
                            ${locationParts.length > 0 ? `
                                <div class="location-hierarchy">
                                    ${locationParts.map(p => `<span class="location-part">${p}</span>`).join('<span class="location-separator">‚Ä∫</span>')}
                                </div>
                            ` : ''}
                            <div class="item-actions">
                                <button class="btn btn-secondary btn-sm" onclick="editItem('${item.id}')">‚úèÔ∏è Bearbeiten</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        function renderLocations() {
            const grid = document.getElementById('locationsGrid');
            
            if (locations.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üì¶</div>
                        <div class="empty-title">Keine Lagerpl√§tze</div>
                        <div class="empty-text">Erstelle deinen ersten Lagerplatz</div>
                        <button class="btn btn-primary" onclick="openLocationModal()">
                            <span>+</span>
                            <span>Erstellen</span>
                        </button>
                    </div>`;
                return;
            }

            grid.innerHTML = locations.map(loc => {
                const parts = [loc.zone, loc.regal, loc.platz, loc.fach].filter(Boolean);
                const itemCount = items.filter(i => 
                    i.zone === loc.zone && 
                    (!loc.regal || i.regal === loc.regal) &&
                    (!loc.platz || i.platz === loc.platz) &&
                    (!loc.fach || i.fach === loc.fach)
                ).length;
                
                return `
                    <div class="item-card">
                        <div class="item-content">
                            <div class="item-name">üì¶ ${loc.name}</div>
                            ${loc.description ? `<div class="item-brand">${loc.description}</div>` : ''}
                            <div class="location-hierarchy" style="margin:12px 0;">
                                ${parts.map(p => `<span class="location-part">${p}</span>`).join('<span class="location-separator">‚Ä∫</span>')}
                            </div>
                            <div class="item-badges">
                                <span class="badge badge-location">${itemCount} Werkzeuge</span>
                            </div>
                            <div style="text-align:center; margin:16px 0;">
                                <canvas id="qr-${loc.id}" style="max-width:120px;"></canvas>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-secondary btn-sm" onclick="downloadLocationQR('${loc.id}')">üì• QR</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteLocation('${loc.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');

            // Generate QR codes
            locations.forEach(loc => {
                const canvas = document.getElementById(`qr-${loc.id}`);
                if (canvas) {
                    QRCode.toCanvas(canvas, loc.id, { width: 120, margin: 1 });
                }
            });
        }

        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            
            if (categories.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üè∑Ô∏è</div>
                        <div class="empty-title">Keine Kategorien</div>
                        <div class="empty-text">Erstelle deine erste Kategorie</div>
                        <button class="btn btn-primary" onclick="openCategoryModal()">
                            <span>+</span>
                            <span>Erstellen</span>
                        </button>
                    </div>`;
                return;
            }

            grid.innerHTML = categories.map(cat => {
                const itemCount = items.filter(i => i.mainCategory === cat.name).length;
                return `
                    <div class="item-card">
                        <div class="item-content">
                            <div class="item-name">${cat.icon || 'üìÅ'} ${cat.name}</div>
                            <div class="item-badges">
                                <span class="badge badge-category">${itemCount} Werkzeuge</span>
                            </div>
                            ${cat.subCategories && cat.subCategories.length > 0 ? `
                                <div style="margin-top:12px;">
                                    ${cat.subCategories.map(s => `<span class="category-tag">${s}</span>`).join('')}
                                </div>
                            ` : ''}
                            <div class="item-actions" style="margin-top:16px;">
                                <button class="btn btn-secondary btn-sm" onclick="editCategory('${cat.id}')">‚úèÔ∏è Bearbeiten</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteCategory('${cat.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        // ============================================
        // STATS & UPDATES
        // ============================================
        function updateStats() {
            const totalItems = items.reduce((sum, i) => sum + (i.quantity || 1), 0);
            const totalValue = items.reduce((sum, i) => sum + ((i.value || 0) * (i.quantity || 1)), 0);
            
            document.getElementById('statItems').textContent = totalItems;
            document.getElementById('statCategories').textContent = categories.length;
            document.getElementById('statLocations').textContent = locations.length;
            document.getElementById('statValue').textContent = `CHF ${totalValue.toFixed(0)}`;
        }

        function updateCategorySelect() {
            const select = document.getElementById('itemCategory');
            const filter = document.getElementById('categoryFilter');
            
            const options = '<option value="">W√§hlen...</option>' + 
                categories.map(c => `<option value="${c.name}">${c.icon || 'üìÅ'} ${c.name}</option>`).join('');
            
            select.innerHTML = options;
            filter.innerHTML = '<option value="">Alle Kategorien</option>' + 
                categories.map(c => `<option value="${c.name}">${c.icon || 'üìÅ'} ${c.name}</option>`).join('');
        }

        function updateSubCategories() {
            const mainCat = document.getElementById('itemCategory').value;
            const subSelect = document.getElementById('itemSubCategory');
            subSelect.innerHTML = '<option value="">Keine</option>';
            
            const cat = categories.find(c => c.name === mainCat);
            if (cat && cat.subCategories) {
                cat.subCategories.forEach(s => {
                    subSelect.innerHTML += `<option value="${s}">${s}</option>`;
                });
            }
        }

        function updateLocationSelect() {
            const select = document.getElementById('itemLocation');
            select.innerHTML = '<option value="">Manuell eingeben</option>' +
                locations.map(l => `<option value="${l.id}">${l.name}</option>`).join('');
        }

        function fillLocationFields() {
            const locId = document.getElementById('itemLocation').value;
            const loc = locations.find(l => l.id === locId);
            
            if (loc) {
                document.getElementById('itemZone').value = loc.zone || '';
                document.getElementById('itemRegal').value = loc.regal || '';
                document.getElementById('itemPlatz').value = loc.platz || '';
                document.getElementById('itemFach').value = loc.fach || '';
            }
        }

        // ============================================
        // MODALS
        // ============================================
        function openItemModal() {
            currentEditId = null;
            document.getElementById('itemModalTitle').textContent = 'Werkzeug hinzuf√ºgen';
            document.getElementById('itemForm').reset();
            document.getElementById('photoPreviewContainer').style.display = 'none';
            updateCategorySelect();
            updateLocationSelect();
            document.getElementById('itemModal').classList.add('active');
        }

        function closeItemModal() {
            document.getElementById('itemModal').classList.remove('active');
        }

        function openLocationModal() {
            currentLocationId = null;
            document.getElementById('locationForm').reset();
            document.getElementById('qrCodeDisplay').style.display = 'none';
            document.getElementById('locationModal').classList.add('active');
        }

        function closeLocationModal() {
            document.getElementById('locationModal').classList.remove('active');
        }

        function openCategoryModal() {
            tempSubCategories = [];
            document.getElementById('categoryForm').reset();
            renderSubCatTags();
            document.getElementById('categoryModal').classList.add('active');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        // ============================================
        // SAVE FUNCTIONS
        // ============================================
        function saveItem(e) {
            e.preventDefault();
            
            const photoSrc = document.getElementById('photoPreview').src;
            const hasPhoto = photoSrc && !photoSrc.endsWith('/') && photoSrc !== window.location.href;
            
            const item = {
                name: document.getElementById('itemName').value,
                quantity: parseInt(document.getElementById('itemQuantity').value) || 1,
                brand: document.getElementById('itemBrand').value,
                model: document.getElementById('itemModel').value,
                mainCategory: document.getElementById('itemCategory').value,
                subCategory: document.getElementById('itemSubCategory').value,
                zone: document.getElementById('itemZone').value,
                regal: document.getElementById('itemRegal').value,
                platz: document.getElementById('itemPlatz').value,
                fach: document.getElementById('itemFach').value,
                value: parseFloat(document.getElementById('itemValue').value) || 0,
                notes: document.getElementById('itemNotes').value,
                photo: hasPhoto ? photoSrc : null,
                updatedAt: new Date().toISOString()
            };

            if (currentEditId) {
                database.ref('werkzeuge/' + currentEditId).update(item);
            } else {
                item.createdAt = new Date().toISOString();
                database.ref('werkzeuge').push(item);
            }
            
            closeItemModal();
        }

        function saveLocation(e) {
            e.preventDefault();
            
            const zone = document.getElementById('locZone').value;
            const regal = document.getElementById('locRegal').value;
            const platz = document.getElementById('locPlatz').value;
            const fach = document.getElementById('locFach').value;
            
            const nameParts = [zone, regal, platz, fach].filter(Boolean);
            
            const loc = {
                name: nameParts.join(' ‚Ä∫ '),
                zone, regal, platz, fach,
                description: document.getElementById('locDescription').value,
                createdAt: new Date().toISOString()
            };

            const ref = database.ref('lagerplaetze').push(loc);
            currentLocationId = ref.key;
            
            // Show QR code
            document.getElementById('qrCodeDisplay').style.display = 'block';
            document.getElementById('qrLabel').textContent = loc.name;
            QRCode.toCanvas(document.getElementById('qrCanvas'), currentLocationId, { width: 200, margin: 2 });
        }

        function saveCategory(e) {
            e.preventDefault();
            
            const cat = {
                name: document.getElementById('catName').value,
                icon: document.getElementById('catIcon').value || 'üìÅ',
                subCategories: tempSubCategories
            };

            database.ref('kategorien').push(cat);
            closeCategoryModal();
        }

        // ============================================
        // EDIT & DELETE
        // ============================================
        function editItem(id) {
            const item = items.find(i => i.id === id);
            if (!item) return;
            
            currentEditId = id;
            document.getElementById('itemModalTitle').textContent = 'Werkzeug bearbeiten';
            
            document.getElementById('itemName').value = item.name || '';
            document.getElementById('itemQuantity').value = item.quantity || 1;
            document.getElementById('itemBrand').value = item.brand || '';
            document.getElementById('itemModel').value = item.model || '';
            
            updateCategorySelect();
            document.getElementById('itemCategory').value = item.mainCategory || '';
            updateSubCategories();
            document.getElementById('itemSubCategory').value = item.subCategory || '';
            
            updateLocationSelect();
            document.getElementById('itemZone').value = item.zone || '';
            document.getElementById('itemRegal').value = item.regal || '';
            document.getElementById('itemPlatz').value = item.platz || '';
            document.getElementById('itemFach').value = item.fach || '';
            
            document.getElementById('itemValue').value = item.value || 0;
            document.getElementById('itemNotes').value = item.notes || '';
            
            if (item.photo) {
                document.getElementById('photoPreview').src = item.photo;
                document.getElementById('photoPreviewContainer').style.display = 'block';
            } else {
                document.getElementById('photoPreviewContainer').style.display = 'none';
            }
            
            document.getElementById('itemModal').classList.add('active');
        }

        function deleteItem(id) {
            if (confirm('Werkzeug wirklich l√∂schen?')) {
                database.ref('werkzeuge/' + id).remove();
            }
        }

        function editCategory(id) {
            const cat = categories.find(c => c.id === id);
            if (!cat) return;
            
            document.getElementById('catName').value = cat.name;
            document.getElementById('catIcon').value = cat.icon || '';
            tempSubCategories = cat.subCategories ? [...cat.subCategories] : [];
            renderSubCatTags();
            
            // Remove old and add new on save
            database.ref('kategorien/' + id).remove();
            document.getElementById('categoryModal').classList.add('active');
        }

        function deleteCategory(id) {
            if (confirm('Kategorie wirklich l√∂schen?')) {
                database.ref('kategorien/' + id).remove();
            }
        }

        function deleteLocation(id) {
            if (confirm('Lagerplatz wirklich l√∂schen?')) {
                database.ref('lagerplaetze/' + id).remove();
            }
        }

        // ============================================
        // HELPERS
        // ============================================
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('page-' + page).classList.add('active');
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            // Close mobile menu
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('mobileMenuOverlay').classList.remove('active');
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('mobileMenuOverlay').classList.toggle('active');
        }

        function previewPhoto(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('photoPreview').src = ev.target.result;
                    document.getElementById('photoPreviewContainer').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function removePhoto() {
            document.getElementById('photoPreview').src = '';
            document.getElementById('photoPreviewContainer').style.display = 'none';
            document.getElementById('photoInput').value = '';
        }

        function addSubCat() {
            const input = document.getElementById('newSubCat');
            const value = input.value.trim();
            if (value && !tempSubCategories.includes(value)) {
                tempSubCategories.push(value);
                renderSubCatTags();
            }
            input.value = '';
        }

        function removeSubCat(index) {
            tempSubCategories.splice(index, 1);
            renderSubCatTags();
        }

        function renderSubCatTags() {
            document.getElementById('subCatTags').innerHTML = tempSubCategories.map((s, i) => 
                `<span class="category-tag">${s} <span class="delete-tag" onclick="removeSubCat(${i})">√ó</span></span>`
            ).join('');
        }

        function downloadQR() {
            const canvas = document.getElementById('qrCanvas');
            const link = document.createElement('a');
            link.download = 'lagerplatz-qr.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function downloadLocationQR(id) {
            const canvas = document.getElementById(`qr-${id}`);
            const loc = locations.find(l => l.id === id);
            const link = document.createElement('a');
            link.download = `${loc.name.replace(/[^a-z0-9]/gi, '-')}-qr.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Enter key for subcategories
        document.addEventListener('DOMContentLoaded', () => {
            const subCatInput = document.getElementById('newSubCat');
            if (subCatInput) {
                subCatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addSubCat();
                    }
                });
            }
        });
    </script>
</body>
</html>
